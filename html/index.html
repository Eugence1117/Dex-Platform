
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="Jozef DvorskÃ½ - creatingo.com">

	<title>Smart Room</title>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<!-- Bootstrap core CSS with custom theme variables + Additional theme styles -->
    <link href="../assets/css/iot-theme-bundle.min.css" rel="stylesheet">
    <!-- <link href="../assets/fontawesome/css/all.css" rel="stylesheet"> -->
    <link href="../assets/fontawesomepro/css/all.css" rel="stylesheet">

	<link href="../assets/css/style.css" rel="stylesheet">

    <!-- <script defer src="../assets/fontawesomepro/js/pro.min.js"></script>
    <script defer src="../assets/fontawesomepro/js/free.min.js"></script> -->
</head>

<body>

	<!-- Preloader -->
	<div id="iot-preloader">
		<div class="center-preloader d-flex align-items-center">
			<div class="spinners">
				<div class="spinner01"></div>
				<div class="spinner02"></div>
			</div>
		</div>
	</div>

	<!-- Alarm Modal -->
	<div class="modal modal-warning centered fade" id="warningModal" tabindex="-1" role="dialog" aria-label="ALARM" aria-hidden="true" data-dismiss="modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content" >
				<div class="modal-body d-flex">
					<div class="icon-sprite icon-2x icon-pulse d-table">
						<span class="fas fa-exclamation-circle d-table-cell align-middle"></span>
					</div>
					<h3 class="text-right font-weight-bold ml-auto align-self-center" id="warningMsg"></h3>
					<audio class="audio" src="../assets/audio/alert_sound.mp3" type="audio/mp3" muted="true" autoplay="true" loop></audio>
				</div>
			</div>
		</div>
	</div>

	<div class="modal modal-danger centered fade" id="dangerModal" tabindex="-1" role="dialog" aria-label="ALARM" aria-hidden="true" data-dismiss="modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-body d-flex">
					<div class="icon-sprite icon-2x icon-pulse d-table">
						<span class="fas fa-exclamation-circle d-table-cell align-middle"></span>
					</div>
					<h3 class="text-right font-weight-bold ml-auto align-self-center" id="dangerMsg"></h3>
					<audio class="audio" src="../assets/audio/emergency_alarm.mp3" type="audio/mp3" muted="true" autoplay="true" loop></audio>
				</div>
			</div>			
		</div>
	</div>

	<!-- Wrapper START -->
	<div id="wrapper" class="hidden">
		<!-- Top navbar START -->
		<nav class="navbar navbar-expand fixed-top d-flex flex-row justify-content-start">
			<div class="d-none d-lg-block">
				<form>
					<div id="menu-minifier">
						<label>
							<svg width="32" height="32" viewBox="0 0 32 32">
								<rect x="2" y="8" width="4" height="3" class="menu-dots"></rect>
								<rect x="2" y="15" width="4" height="3" class="menu-dots"></rect>
								<rect x="2" y="22" width="4" height="3" class="menu-dots"></rect>
								<rect x="8" y="8" width="21" height="3" class="menu-lines"></rect>
								<rect x="8" y="15" width="21" height="3" class="menu-lines"></rect>
								<rect x="8" y="22" width="21" height="3" class="menu-lines"></rect>
							</svg>
							<input id="minifier" type="checkbox"> 
						</label>
						<div class="info-holder info-rb">
							<div data-toggle="popover-all" data-content="Checkbox element using localStorage to remember the last status." data-original-title="Side menu narrowing" data-placement="right"></div>
						</div>
					</div>
				</form>
			</div>
			<a class="navbar-brand px-lg-3 px-1 mr-0" href="#">Smart Room</a>
			<div class="ml-auto">
				<div class="navbar-nav flex-row navbar-icons">
					<div class="nav-item d-lg-none">
						<button id="sidebar-toggler" type="button" class="btn btn-link nav-link" data-toggle="offcanvas">
						<div class="icon-sprite">
                            <span class="fas fa-bars"></span>
                        </div>
						</button>
					</div>
				</div>
			</div>
		</nav>
		<!-- Top navbar END -->
		<!-- wrapper-offcanvas START -->
		<div class="wrapper-offcanvas">
			<!-- row-offcanvas START -->
			<div class="row-offcanvas row-offcanvas-left">
				<!-- Side menu START -->
				<div id="sidebar" class="sidebar-offcanvas">
					<ul class="nav flex-column nav-sidebar">
						<li class="nav-item active">
							<a class="nav-link active" href="index.html">
								<div class="icon-sprite">
                                    <i class="far fa-home"></i>
                                </div>
                                Home
							</a>
						</li>
                        <li class="nav-item">
                            <a class="nav-link" href="simulator.html">
                                <div class="icon-sprite">
                                    <i class="far fa-keyboard"></i>
                                </div>
                                Simulator
                            </a>
                        </li>
					</ul>
				</div>
				<!-- Side menu END -->
				<!-- Main content START -->
				<div id="main">
					<div class="container-fluid">
						<div class="row">
							<div class="col-sm-12 col-md-6">
								<div class="card lock" data-unit="switch-sensor-lock">
									<div class="card-body">
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-2x">
												<span class="fas fa-home"></span>
											</div>
											<div class="title-status">
												<h4>Smart System</h4>
											</div>
										</div>
										<hr class="dropdown-divider"/>
										<div class="row">
											<div class="col">
												<div id="sensorList">
													<ul class="list-group list-group-flush">
														<li class="list-group-item px-0 py-2 d-flex">
															<h5 class="card-subtitle">Light Sensor</h5>
															<label class="ml-auto switch">
																<input type="checkbox" id="switch-sensor-light"  class="sensor-checkbox" data-name="switch-sensor-light">
                                                                <!-- <span class="badge badge-primary" id="switch-sensor-light">On</span> -->
															</label>
														</li>
														<li class="list-group-item px-0 py-2 d-flex">
															<h5 class="card-subtitle">Door Sensor</h5>
															<label class="ml-auto switch">
																<input type="checkbox" id="switch-sensor-door" class="sensor-checkbox" data-name="switch-sensor-door">
                                                                <!-- <span class="badge badge-primary" id="switch-sensor-door">On</span> -->
															</label>
														</li>	
														<li class="list-group-item px-0 py-2 d-flex">
															<h5 class="card-subtitle">Temperature & Humidity Sensor</h5>
															<label class="ml-auto switch">
																<input type="checkbox" id="switch-sensor-temp"  class="sensor-checkbox" data-name="switch-sensor-temp">
															</label>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- Security system END -->
							</div>
							<div class="col-sm-12 col-md-6">
								<div class="card">
									<div class="card-body">
										<!--rgba(15,156,230,.45) Non Active color-->
										<!--#aee0fa; Active color-->
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-1x d-table">
												<span class="fal fa-door-closed d-table-cell align-middle bright" id="doorIcon"></span>
                                            </div>
											<div class="title-status">
												<h5 class="d-table-cell align-middle">Main Door</h5>
											</div>
											<div class="ml-auto d-table">
												<span class="d-table-cell align-middle">
													<span class="badge badge-warning" id="door-status">Opened</span>
												</span>
											</div>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-1x d-table">
												<span class="far fa-lightbulb d-table-cell align-middle dim" fill="url(#radial-glow)" id="lightIcon"></span>
                                            </div>
											<div class="title-status d-table">
												<h5 class="d-table-cell align-middle">Light </h5>
											</div>
											<div class="ml-auto d-table">
												<label class="ml-auto switch">
													<input type="checkbox" id="switch-light" class="device-checkbox" data-name="switch-light"/>                                                   
												</label>
											</div>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-1x d-table">
												<span class="far fa-air-conditioner d-table-cell align-middle dim" fill="url(#radial-glow)" id="airconIcon"></span>
                                            </div>
											<div class="title-status d-table">
												<h5 class="d-table-cell align-middle">Air Conditioner </h5>
												<div class="d-table-row">
													<div class="d-table" id="dryMode">
														<p class="d-table-cell specs align-middle" style="color:rgba(15,156,230,.6);font-size: 0.9rem;">Dry Mode :</p>
														<label class="switch d-table-cell align-middle">
															<input type="checkbox" id="switch-dry-mode" class="device-checkbox" data-name="switch-dry-mode">
														</label>
													</div>
												</div>												
											</div>
											<div class="ml-auto">
												<label class="ml-auto switch">
													<input type="checkbox" id="switch-air-conditioner" class="device-checkbox" data-name="switch-air-conditioner">
												</label>
											</div>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-1x d-table">
												<span class="fal fa-fan-table d-table-cell align-middle dim" fill="url(#radial-glow)" id="fanIcon"></span>
                                            </div>
											<div class="title-status d-table">
												<h5 class="d-table-cell align-middle">Fan</h5>
											</div>
											<div class="ml-auto">
												<label class="ml-auto switch">
													<input type="checkbox" id="switch-fan" class="device-checkbox" data-name="switch-fan">
												</label>
											</div>
										</div>
									</div>
								</div>
								<div class="card">
									<div class="card-body">
										<div class="d-flex flex-wrap">
											<div class="icon-sprite icon-1x d-table">
												<span class="fal fa-lock d-table-cell align-middle bright" fill="url(#radial-glow)" id="lockIcon"></span>
                                            </div>
											<div class="title-status d-table">
												<h5 class="d-table-cell align-middle">Door lock</h5>
											</div>
											<div class="ml-auto">
												<label class="ml-auto switch">
													<input type="checkbox" id="switch-lock" class="device-checkbox" data-name="switch-lock">
												</label>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-12">
								<div class="card">
									<div class="card-body">
										<h4>Room Temperature & Humidity (last 24 hrs)</h4>
										<hr class="my-0"/>
									</div>
									<div class="card-body">
										<div>
											<div id="emptyMsg" class="text-center d-none">
												<p><span class="fal fa-meh-blank"></span> No data to display</p>
											</div>
											<canvas id="myChart"></canvas>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-12">
								<div class="card">
									<div class="card-body">
										<h4>Current Location</h4>
										<hr class="my-0"/>
									</div>
									<div class="card-body">
										<div class="w-100" id="currentLocation" style="height:400px">

										</div>
									</div>
								</div>
							</div>
						</div>
						<br><br>
					</div>
					<!-- Main content overlay when side menu appears  -->
					<div class="cover-offcanvas" data-toggle="offcanvas"></div>
				</div>
				<!-- Main content END -->
			</div>
			<!-- row-offcanvas END -->
		</div>
		<!-- wrapper-offcanvas END -->
	</div>
	<!-- Wrapper END -->

	<!-- SVG assets - not visible -->
	<svg id="svg-tool" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
      <style type="text/css">
          .glow circle {fill:url(#radial-glow)}
      </style>
      <filter id="blur" x="-25%" y="-25%" width="150%" height="150%">
          <feGaussianBlur in="SourceGraphic" stdDeviation="3"/>
      </filter>
      <radialGradient id="radial-glow" fx="50%" fy="50%" r="50%">
          <stop offset="0" stop-color="#0F9CE6" stop-opacity="1"/>
          <stop offset="1" stop-color="#0F9CE6" stop-opacity="0" />
      </radialGradient>
    </defs>
  </svg>

	<!-- jQuery -->
    <script src="../assets/js/jquery-3.4.1.min.js"></script>

	<!-- Bootstrap bundle -->
	<script src="../assets/js/bootstrap.bundle.min.js"></script>

	<script src="../assets/bootbox/bootbox.all.min.js"></script>

	<script src="../assets/js/iot-functions.min.js"></script>

	<script src="../assets/js/chartist.min.js"></script>

	<script src="../assets/js/moment.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsi3wrZP6FncQZsaZ-MXJCraMDfCqSCX4"></script>

	<script type="module">

		import {initializeApp} from "https://www.gstatic.com/firebasejs/9.0.1/firebase-app.js";
		import * as firebase from "https://www.gstatic.com/firebasejs/9.0.1/firebase-database.js";

		$(document).ready(function() {
			$(".audio").prop('muted', true);
			// Get checkbox statuses from localStorage if available (IE)
			if (localStorage) {

				// Menu minifier status (Contract/expand side menu on large screens)
				var checkboxValue = localStorage.getItem('minifier');

				if (checkboxValue === 'true') {
					$('#sidebar,#menu-minifier').addClass('mini');
					$('#minifier').prop('checked', true);

				} else {

					if ($('#minifier').is(':checked')) {
						$('#sidebar,#menu-minifier').addClass('mini');
						$('#minifier').prop('checked', true);
					} else {
						$('#sidebar,#menu-minifier').removeClass('mini');
						$('#minifier').prop('checked', false);
					}
				}				
			}

			// Contract/expand side menu on click. (only large screens)
			$('#minifier').click(function() {

				$('#sidebar,#menu-minifier').toggleClass('mini');

				// Save side menu status to localStorage if available (IE)
				if (localStorage) {
					checkboxValue = this.checked;
					localStorage.setItem('minifier', checkboxValue);
				}

			});


			// Side menu toogler for medium and small screens
			$('[data-toggle="offcanvas"]').click(function() {
				$('.row-offcanvas').toggleClass('active');
			});

			// Reposition to center when a modal is shown
			$('.modal.centered').on('show.bs.modal', iot.centerModal);

			// Alerts "Close" callback - hide modal and alert indicator dot when user closes all alerts
			$('#alertsModal .alert').on('close.bs.alert', function() {
				var sum = $('#alerts-toggler').attr('data-alerts');
				sum = sum - 1;
				$('#alerts-toggler').attr('data-alerts', sum);

				if (sum === 0) {
					$('#alertsModal').modal('hide');
					$('#alerts-toggler').attr('data-toggle', 'none');

				}

			});
			
			const firebaseConfig = {
				apiKey: "AIzaSyBsi3wrZP6FncQZsaZ-MXJCraMDfCqSCX4",
				authDomain: "smart-room-d66b5.firebaseapp.com",
				databaseURL: "https://smart-room-d66b5-default-rtdb.asia-southeast1.firebasedatabase.app",
				projectId: "smart-room-d66b5",
				storageBucket: "smart-room-d66b5.appspot.com",
				messagingSenderId: "567793747402",
				appId: "1:567793747402:web:6b5deb54ec7501dae9bb33"
			};

			// Initialize Firebase
			const app = initializeApp(firebaseConfig);
			
			var dbRef = firebase.getDatabase();
			const doorSensor = firebase.ref(dbRef,"/magnetic_switch_door")
			firebase.onValue(doorSensor,(snapshot) =>{
				var isEnabled = snapshot.val()["isEnabled"]
				var status = snapshot.val()["status"]
				switchLabel($("#switch-sensor-door"),isEnabled)
				switchDoor(status)
			})

			const lightSensor = firebase.ref(dbRef,"/light_sensor_001")
			firebase.onValue(lightSensor,(snapshot) =>{
				var isEnabled = snapshot.val()["isEnabled"]
				switchLabel($("#switch-sensor-light"),isEnabled)
			})

			const dhtSensor = firebase.query(firebase.ref(dbRef,"/dht_sensor/isEnabled"))
			firebase.onValue(dhtSensor,(snapshot) =>{
				var isEnabled = snapshot.val()
				switchLabel($("#switch-sensor-temp"),isEnabled)
			})

			//Scubscribe to emergency alert
			const emergencyAlert = firebase.ref(dbRef,"emergency_alert")
			firebase.onValue(emergencyAlert,(snapshot) =>{
				if(snapshot.exists()){
					var data = snapshot.val()
					$("#dangerMsg").text(data.msg)
					$("#dangerModal").modal()

					$("#dangerModal").find(".audio").prop("muted",false)
					var audio = $("#dangerModal").find(".audio")[0]
					audio.play()

					$("#dangerModal").on('hidden.bs.modal',function(){
						audio.pause()
						audio.currentTime = 0
						firebase.set(emergencyAlert,null)
					})
				}
				else{
					var audio = $("#dangerModal").find(".audio")[0]
					audio.pause()
					audio.currentTime = 0

					$("#dangerModal").modal("hide")
				}
			})
			//Subscribe to normal alert
			const alert = firebase.ref(dbRef,"alert")
			firebase.onValue(alert,(snapshot) =>{
				if(snapshot.exists()){
					var data = snapshot.val()
					$("#warningMsg").text(data.msg)
					$("#warningModal").modal()
					
					$("#warningModal").find(".audio").prop("muted",false)
					var audio = $("#warningModal").find(".audio")[0]
					audio.play()

					$("#warningModal").on('hidden.bs.modal',function(){
						audio.pause()
						audio.currentTime = 0
						firebase.set(alert,null)
					})
				}
				else{
					var audio = $("#warningModal").find(".audio")[0]
					audio.pause()
					audio.currentTime = 0

					$("#warningModal").modal("hide")
				}
			})

			var map = null
			var marker = null
			const location = firebase.ref(dbRef,"/gps_sensor")
			firebase.onValue(location,(snapshot)=>{
				if(snapshot.exists()){
					var data = snapshot.val()
					var lat = data.latitude
					var long = data.longitude
					if(map == null){
						map = new google.maps.Map(document.getElementById('currentLocation'), {
							center: {lat:lat, lng:long},
							zoom: 15,
							mapId:'fe2f32559a6a767d'
						});

						marker = new google.maps.Marker({
							position:{lat:lat, lng:long},
							map: map,
						});
					}
					else{
						map.panTo({lat:lat, lng:long})

						marker.setPosition({lat:lat, lng:long})
					}
				}
			});


			var yesterday = new Date()
			yesterday.setDate(yesterday.getDate() - 1)
			var timestamp = Math.round(yesterday.getTime()/1000)
			const dhtData = firebase.ref(dbRef,"/dht_sensor/data")
			var query = firebase.query(dhtData, firebase.orderByKey(),firebase.startAfter(String(timestamp)))
			firebase.get(query).then((snapshot) =>{
				if(snapshot.exists()){
					$("#emptyMsg").addClass("d-none")

					var labels = []
					var temp = []
					var hum = []
					snapshot.forEach(function(children){
						var data = children.val()
						var time = moment.unix(children.key).format("HH:mm:ss")

						//var obj = {}
						temp.push(data.temperature)
						labels.push(time)
						hum.push(data.humidity)

						//dataList.push(obj)
					})
					
					const data = {
						labels:labels,
						datasets:[{
							label:"Temperature",
							data:temp,
							fill: false,
							borderColor: 'rgb(75, 192, 192)',
							tension: 0.1
						},
						{
							label:"Humidity %",
							data:hum,
							fill: false,
							borderColor:'rgba(255, 99, 132)',
							tension: 0.1
						}]
					}
					var chart = new Chart($("#myChart"),{
						type: 'line',
						data:data,
						options: {
							maintainAspectRatio:false
						}
					});
					
					const latestDht = firebase.query(firebase.ref(dbRef,"/dht_sensor/data"), firebase.orderByKey(),firebase.limitToLast(1))
					firebase.onValue(latestDht,(snapshot) =>{
						snapshot.forEach(function(child){
							var key = child.key
							var data = child.val()

							var time = moment.unix(key).format("HH:mm:ss")
							var newTemp = data.temperature
							var newHum = data.humidity
							const chartData = chart.data
							if (chartData.datasets.length > 0) {
								var lastLabel = chartData.labels[chartData.labels.length-1]
								if(lastLabel == time){
									//Skip
								}
								else{
									chartData.labels.push(time)
									chartData.datasets[0].data.push(newTemp)
									chartData.datasets[1].data.push(newHum)

									chart.update()
								}
							}
							
						})
					})

				}
				else{
					$("#emptyMsg").removeClass("d-none")
					var query = firebase.query(dhtData, firebase.orderByKey(),firebase.startAfter(String(timestamp)))
					var listener = firebase.onValue(query,(snapshot) =>{
						if(snapshot.exists()){
							$("#emptyMsg").addClass("d-none")
							var labels = []
							var temp = []
							var hum = []
							snapshot.forEach(function(child){
								var key = child.key
								var newData = child.val()
								var time = moment.unix(key).format("HH:mm:ss")

								labels.push(time)
								temp.push(newData.temperature)
								hum.push(newData.humidity)
								
							});	
							const data = {
								labels:labels,
								datasets:[{
									label:"Temperature",
									data:temp,
									fill: false,
									borderColor: 'rgb(75, 192, 192)',
									tension: 0.1
								},
								{
									label:"Humidity %",
									data:hum,
									fill: false,
									borderColor:'rgba(255, 99, 132)',
									tension: 0.1
								}]
							}
							
							
							var chart = new Chart($("#myChart"),{
								type: 'line',
								data:data,
								options: {
									maintainAspectRatio:false
								}
							});

							//Remove listener once read value
							firebase.off(dhtData)
							
							const latestDht = firebase.query(firebase.ref(dbRef,"/dht_sensor/data"), firebase.orderByKey(),firebase.limitToLast(1))
							firebase.onValue(latestDht,(snapshot) =>{
								console.log("Declear Event")
								snapshot.forEach(function(child){
									var key = child.key
									var data = child.val()

									var time = moment.unix(key).format("HH:mm:ss")
									var newTemp = data.temperature
									var newHum = data.humidity
									const chartData = chart.data
									if (chartData.datasets.length > 0) {
										var lastLabel = chartData.labels[chartData.labels.length-1]
										if(lastLabel == time){
											//Skip
										}
										else{
											chartData.labels.push(time)
											chartData.datasets[0].data.push(newTemp)
											chartData.datasets[1].data.push(newHum)

											chart.update()
										}
									}
								})
							})
						}
					})
				}
			})

			const lock = firebase.ref(dbRef,"/solenoid_lock")
			firebase.onValue(lock,(snapshot) =>{
				var status = snapshot.val()["status"]
				switchLock(status)
			})

			const led = firebase.ref(dbRef,"/led_light_table")
			firebase.onValue(led,(snapshot) =>{
				var status = snapshot.val()["status"]
				switchLight(status)
			})

			const fan = firebase.ref(dbRef,"/fan")
			firebase.onValue(fan,(snapshot) =>{
				var status = snapshot.val()["status"]
				switchFan(status)
			})
			
			const aircon = firebase.ref(dbRef,"/air_conditioner")
			firebase.onValue(aircon,(snapshot) =>{
				var airconStatus = snapshot.val()["status"]
				var drymode = snapshot.val()["dryMode"]
				switchAirCon(airconStatus,drymode)
			})

			$(".switch input[type=checkbox").on('change',function(){
				var name = $(this).data("name")
				var statusChanged = $(this).prop("checked")
				switch (name){
					case "switch-sensor-light":
						firebase.update(firebase.ref(dbRef,"/light_sensor_001"),{
							"isEnabled":statusChanged
						});
					break
					case "switch-sensor-door":
						firebase.update(firebase.ref(dbRef,"/magnetic_switch_door"),{
							"isEnabled":statusChanged
						})
					break
					case "switch-sensor-temp":
						firebase.update(firebase.ref(dbRef,"/dht_sensor"),{
							"isEnabled":statusChanged
						})
					break
					case "switch-light":
						var currentTime = Math.round(new Date().getTime() / 1000)
						firebase.update(firebase.ref(dbRef,"/"),{
							"light_sensor_001/isEnabled":false,
							"light_sensor_001/time_stamp":currentTime,
							"led_light_table/status":statusChanged,
							"led_light_table/time_stamp":currentTime,
						})
					break
					case "switch-air-conditioner":
						firebase.update(firebase.ref(dbRef,"/"),{
							"air_conditioner/status":statusChanged,
							"dht_sensor/isEnabled":false
						})
					break
					case "switch-dry-mode":
						firebase.update(firebase.ref(dbRef,"/"),{
							"air_conditioner/dryMode":statusChanged,
							"dht_sensor/isEnabled":false
						})
					break
					case "switch-fan":
						firebase.update(firebase.ref(dbRef,"/"),{
							"fan/status":statusChanged,
							"dht_sensor/isEnabled":false
						})
					break
					case "switch-lock":
						const checkDoorStatus = firebase.ref(dbRef,"/magnetic_switch_door")
						firebase.get(checkDoorStatus).then((snapshot) =>{
							if(snapshot.exists()){
								var doorStatus = snapshot.val()["status"]
								if(doorStatus){
									firebase.update(firebase.ref(dbRef,"/solenoid_lock"),{
										"status":statusChanged
									})
								}
								else{
									bootbox.alert("Unable to control the lock while the door is opened !")
								}
							}
						})
					break
				}
			})

		});

		function switchLock(status){
			var lockIcon = $("#lockIcon")
			var lockStatus = $("#switch-lock")
			if(lockStatus.data("status") != status){
				lockIcon.hide()
				lockStatus.hide()
				if(status){
					lockIcon.removeClass("dim").removeClass("fa-lock-open").addClass("bright").addClass("fa-lock").fadeIn(500,"swing")
					triggerSwitch(lockStatus,status)
				}
				else{
					lockIcon.addClass("dim").addClass("fa-lock-open").removeClass("bright").removeClass("fa-lock").fadeIn(500,"swing")
					triggerSwitch(lockStatus,status)
				}
				lockStatus.data("status",status)
			}
		}

		function switchFan(status){
			var fanIcon = $("#fanIcon")
			var fanStatus = $("#switch-fan")
			if(fanStatus.data("status") != status){
				fanStatus.hide()
				if(status){
					fanIcon.removeClass("dim").addClass("bright")
					triggerSwitch(fanStatus,status)
				}
				else{
					fanIcon.addClass("dim").removeClass("bright")
					triggerSwitch(fanStatus,status)
				}
				fanStatus.data("status",status)
			}
		}
		
		function switchAirCon(status,dryModeStatus){
			var airconIcon = $("#airconIcon")
			var airconStatus = $("#switch-air-conditioner")
			var dryMode = $("#switch-dry-mode")
			if(airconStatus.data("status") != status){
				airconStatus.hide()
				if(status){
					airconIcon.removeClass("dim").addClass("bright")
					triggerSwitch(airconStatus,status)
					// airconStatus.removeClass("badge-secondary").addClass("badge-primary").text("On").fadeIn(500,"swing")
					$("#dryMode").removeClass("d-none").addClass("d-table")
				}
				else{
					airconIcon.addClass("dim").removeClass("bright")
					triggerSwitch(airconStatus,status)
					// airconStatus.addClass("badge-secondary").removeClass("badge-primary").text("Off").fadeIn(500,"swing")
					$("#dryMode").removeClass("d-table").addClass("d-none")
				}
				airconStatus.data("status",status)
			}

			if(dryMode.data("status") != dryModeStatus && status){
				$("#dryMode").removeClass("d-none").addClass("d-table")				
				triggerSwitch(dryMode,dryModeStatus)
				dryMode.data("status",dryModeStatus)
			}
		}

		function switchLight(status){
			var lightIcon = $("#lightIcon")
			var lightStatus = $("#switch-light")
			if(lightStatus.data("status") != status){
				lightStatus.hide()
				if(status){
					lightIcon.removeClass("dim").addClass("bright")
					triggerSwitch(lightStatus,true)
				}
				else{
					lightIcon.addClass("dim").removeClass("bright")
					triggerSwitch(lightStatus,false)
				}
				lightStatus.data("status",status)
			}
		}

		function switchDoor(status){

			var doorIcon = $("#doorIcon")
			var doorStatus = $("#door-status")
			if(doorStatus.data("status") != status){
				doorIcon.hide()
				doorStatus.hide()
				if(!status){ //Open
					doorIcon.removeClass("fa-door-closed").removeClass("dim").addClass("fa-door-open").addClass("bright").fadeIn(500,"swing")
					doorStatus.removeClass("badge-secondary").addClass("badge-warning").text("Opened").fadeIn(500,"swing")
				}
				else{
					doorIcon.removeClass("fa-door-open").removeClass("bright").addClass("fa-door-closed").addClass("dim").fadeIn(500,"swing")
					doorStatus.addClass("badge-secondary").removeClass("badge-warning").text("Closed").fadeIn(500,"swing")
				}
				doorStatus.data("status",status)		
			}
		}

		function switchLabel(item,status){
			var item = $(item)			
			if(item.data("status") != status){				
				triggerSwitch(item,status)
				item.data("status",status)
			}
		}

		function triggerSwitch(item,status){
			if(status){
				item.prop("checked", true)
				item.parent().addClass("checked")
			}
			else{
				item.prop('checked', false)
				item.parent().removeClass("checked")
			}
		}

		// Apply necessary changes, functionality when content is loaded
		$(window).on('load', function() {
			// "Timeout" function is not neccessary - important is to hide the preloader overlay
			setTimeout(function() {

				// Hide preloader overlay when content is loaded
				$('#iot-preloader,.card-preloader').fadeOut();
				$("#wrapper").removeClass("hidden");

			}, 800);

		});

		// Apply necessary changes if window resized
		$(window).on('resize', function() {

			// Modal reposition when the window is resized
			$('.modal.centered:visible').each(iot.centerModal);

			// Check for Main contents scrollbar visibility and set right position for FAB button
			iot.positionFab();
		});

	</script>

</body>

</html>
