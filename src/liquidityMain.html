<html>
    <head>
        <title>Liquidity</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <script src="js/jquery-3.4.1.min.js"></script>
        <link href="css/style.css" rel="stylesheet" /> <!--Bootstrap Style-->        
        <script src="plugins/bootstrap-5.1.3/js/bootstrap.bundle.min.js" type="text/javascript"></script>
        <link href="plugins/fontawesomepro/css/all.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"rel="stylesheet">
        <link href="css/re-liquidity.css" rel="stylesheet" />
        <link href="plugins/notiflix/notiflix-3.2.2.min.css" rel="stylesheet"/>
        
        <script type="text/javascript">
            function rangeSlide(value) {
                document.getElementById('rangeValue').innerHTML = value;
            }
        </script>

        <style>
            .token{
                max-width:15%;
            }
            @media (max-width: 768px) {
                .row{
                    display:block;
                }
                .col,div[class*="col-"],.btn{
                    width: 100%;
                }
                .token{
                    max-width: 40%;
                }
                .footer{
                    margin:16px 0px 16px 0px;
                }           
            }
        </style>
    </head>

        <body>            
            <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark" id="navbar">
                <div class="container">
                    <a href="index.html" class="navbar-brand d-flex align-items-center">                        
                        <span class=" fw-bolder fs-2">DEX</span>   
                    </a>                
                    
                    <button class="navbar-toggler" type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#navbarResponsive"
                        aria-controls="navbarResponsive"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarResponsive">
                        <ul class="navbar-nav me-auto">
                            <li class="nav-item">
                                <a class="nav-link active"
                                    href="liquidityMain.html">Liquidity
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="swap.html">Swap</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="wrapper mt-5" style="padding:5em 0.5em">
                <div class="content-wrapper d-flex align-items-center">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col"></div>
                            <div class="col-8">
                                <div class="fa-pull-right d-inline-block">
                                    <a class="btn a-btn-slide-text btn-outline-light btn-sm btn-block" data-bs-toggle="modal" data-bs-target="#addTokenModal">
                                        <span class="fas fa-plus-circle" aria-hidden="true"></span>
                                        <span>Import Token</span>
                                    </a>
                                </div>
                            </div>
                            <div class="col"></div>
                        </div>
                        <div class="row">
                            <div class="col"></div>
                            <div class="col-8">
                                <div class="row">                            
                                    <div class="col-md p-3 mb-2">
                                        <div class="card">
                                            <div class="card-header">
                                                <a class="btn" data-bs-toggle="collapse" href="#listLiquidity" data-bs-target="#listLiquidity" aria-expanded="true" aria-controls="listLiquidity"><h4><i class="fas fa-list"></i> Your Liquidity</h4></a>
                                                <div class="fa-pull-right d-inline-block">
                                                    <a class="btn a-btn-slide-text btn-outline-light btn-sm btn-block" data-bs-toggle="modal" data-bs-target="#addPoolModal">
                                                        <span class="fas fa-plus-circle" aria-hidden="true"></span>
                                                        <span>Import Pool</span>
                                                    </a>

                                                    <a class="btn a-btn-slide-text btn-outline-light btn-sm btn-block" id="refreshPoolBtn">
                                                        <span class="fas fa-sync" aria-hidden="true"></span>
                                                        <span>Refresh Pool</span>
                                                    </a>
                                                </div>
                                            </div>
        
                                            <div id="listLiquidity" class="collapse show" aria-labelledby="listLiquidity">
                                                <div class="card-body">
                                                    <ul class="list-group list-group-flush" id="poolGroup">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md p-3 mb-2">
                                        <div class="card">
                                            <div class="card-header">
                                                <a class="btn" data-bs-toggle="collapse" href="#addLiquidity" aria-expanded="true" aria-controls="addLiquidity"><h4><i class="fas fa-donate"></i> Fund Liquidity Pool</h4></a>
                                            </div>
        
                                            <div id="addLiquidity" class="collapse show" aria-labelledby="newLiquidity">
                                                <div class="card-body">
                                                    <form id="addForm">
                                                        <div class="text-center" style="padding:8px 16px">  
                                                            <div class="row mt-2">
                                                                <div class="col">
                                                                    <div class="input-group">
                                                                        <select class="btn btn-outline-secondary token form-select input-group-text" name="tokenA" data-index="0">
                                                                            <option selected value="0">No Token</option>
                                                                          </select>
                                                                        <input type="text text-end" class="form-control" placeholder="0.00" name="tokenAVal">
                                                                    </div>                                                        
                                                                </div>
                                                            </div>
                                                            <div class="row my-4">

                                                            </div>
                                                            <div class="row mb-2">
                                                                <div class="col">
                                                                    <div class="input-group">                                                            
                                                                        <select class="btn btn-outline-secondary token form-select input-group-text" name="tokenB" data-index="1">
                                                                            <option selected value="0">No Token</option>                                                                        
                                                                          </select>
                                                                        <input type="text text-end" class="form-control" placeholder="0.00" name="tokenBVal">
                                                                    </div>                                                        
                                                                </div>
                                                            </div>
                                                            <div class="row mt-3">
                                                                <div class="col">
                                                                    <div class="row">
                                                                        <div class="col mb-4">
                                                                            <div class="card">
                                                                                <div class="card-body">
                                                                                    <p class="ratioAB">0</p>
                                                                                    <span class="tokenA"> </span> per <span class="tokenB"></span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col mb-4">
                                                                            <div class="card">
                                                                                <div class="card-body">
                                                                                    <p class="ratioAB">0</p>
                                                                                    <span class="tokenB"> </span> per <span class="tokenA"></span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col mb-4">
                                                                            <div class="card">
                                                                                <div class="card-body">
                                                                                    <p>00.00%</p>
                                                                                    <span>Share of Pool</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="footer text-center">
                                                                <button class="btn btn-primary text-uppercase" id="fundBtn"><i class="fas fa-donate"></i> Fund This Pool</button>
                                                            </div>
                                                        </div>
                                                    </form>                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md p-3 mb-2">
                                        <div class="card">
                                            <div class="card-header">
                                                <a class="btn" data-bs-toggle="collapse" href="#newLiquidity" aria-expanded="true" aria-controls="newLiquidity"><h4><i class="fas fa-plus-circle"></i> Create New Liquidity Pool</h4></a>
                                            </div>
        
                                            <div id="newLiquidity" class="collapse show" aria-labelledby="newLiquidity">
                                                <div class="card-body">
                                                    <form id="newForm">
                                                        <div class="text-center" style="padding:8px 16px">  
                                                            <div class="row mt-2">
                                                                <div class="col">
                                                                    <div class="input-group">
                                                                        <select class="btn btn-outline-secondary token form-select input-group-text" name="tokenA" data-index="0">
                                                                            <option selected value="0">No Token</option>
                                                                        </select>
                                                                    <input type="text text-end" class="form-control" placeholder="0.00" name="tokenAVal">
                                                                </div>                                                        
                                                            </div>
                                                        </div>
                                                        <div class="row my-4">
                                                        </div>
                                                        <div class="row mb-2">
                                                            <div class="col">
                                                                <div class="input-group">                                                            
                                                                    <select class="btn btn-outline-secondary token form-select input-group-text" name="tokenB" data-index="1">
                                                                        <option selected value="0">No Token</option>
                                                                    </select>
                                                                    <input type="text text-end" class="form-control" placeholder="0.00" name="tokenBVal">
                                                                </div>                                                        
                                                            </div>
                                                        </div>
                                                        <div class="row mt-3">
                                                            <div class="col">
                                                                <div class="row">
                                                                    <div class="col mb-4">
                                                                        <div class="card">
                                                                            <div class="card-body">
                                                                                <p class="ratioAB">0</p>
                                                                                <span class="tokenA"> </span> per <span class="tokenB"></span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col mb-4">
                                                                        <div class="card">
                                                                            <div class="card-body">
                                                                                <p class="ratioBA">0</p>
                                                                                <span class="tokenB"> </span> per <span class="tokenA"></span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                  </div>
                                                            </div>
                                                         </div>
                                                        <div class="footer text-center">
                                                            <button class="btn btn-primary text-uppercase" id="createBtn"><i class="fas fa-plus"></i> Create Pool</button>
                                                        </div>
                                                    </form>                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                            <div class="col"></div>
                        </div>                        
                    </div>
                </div>
            </div>

            <div class="modal fade" tabindex="-1" role="dialog" id="addPoolModal">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Import Pool</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addPoolForm">
                                <input type="text" class="form-control" placeholder="0x0000" id="poolAddress" name="poolAddress" />
                            </form> 
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary mb-3" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary mb-3" id="addPoolBtn">Import</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" tabindex="-1" role="dialog" id="addTokenModal">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Import Token</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addTokenForm">
                                <input type="text" class="form-control" placeholder="0x0000" id="tokenAddress" name="tokenAddress" />
                            </form> 
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary mb-3" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary mb-3" id="addTokenBtn">Import</button>
                        </div>
                    </div>
                </div>
            </div>

              <div class="modal fade" tabindex="-1" role="dialog" id="withdrawModal">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Withdraw Liquidity</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">                        
                      </button>
                    </div>
                    <div class="modal-body">
                        <div class="section">
                            <div class="p-2">
                                <span id="rangeValue">0 </span><span style="display: inline-block;">%</span>
                                <Input class="range" name="tokenCount" type="range" value="0" min="0" max="100" onChange="rangeSlide(this.value)" 
                            onmousemove="rangeSlide(this.value)"></Input>
                            </div>
                            <div class="row p-2">
                                <div class="col-md">
                                    <span>Token Spend :</span>
                                </div>
                                <div class="col-md text-end">
                                    <span id="tokenSpend">0 LPT</span>
                                </div>
                            </div>
                        </div>
                        <div class="my-3 text-center">
                            <h3><span class="fas fa-angle-double-down"></span></h3>                            
                        </div>
                        <div class="section">
                            <div class="row p-3">
                                <div class="col-md tokenA">
                                    Token A
                                </div>
                                <div class="col-md text-end tokenAVal">
                                    0.000000
                                </div>
                            </div>
                            <div class="row p-3">
                                <div class="col-md tokenB">
                                    Token B
                                </div>
                                <div class="col-md text-end tokenBVal">
                                    0.000000
                                </div>
                            </div>                            
                        </div>
                    </div>
                    <div class="modal-footer">                      
                      <button type="button" class="btn btn-secondary mb-3" data-bs-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary mb-3" id="withdrawBtn">Withdraw</button>
                    </div>
                  </div>
                </div>
              </div>
        </body>
        <script type="text/javascript" src="plugins/notiflix/notiflix-3.2.2.min.js"></script>
        <script type="text/javascript" src="js/web3.min.js"></script>
        <script type="text/javascript" src="js/truffle-contract.js"></script>        
        <script type="text/javascript" src="js/app.js"></script>    
        <script type="text/javascript" src="plugins/jquery-validator/jquery-validate-min.js"></script>
        <script type="text/javascript" src="js/validator-config.js"></script>        

        <script>
            $(".swap").on('click',function(e){
                e.preventDefault();
                var form = $("#"+$(this).data("reference"));                
                
                var from = form.find("select[name=tokenA]");
                var fromVal = form.find("input[name=tokenAVal]");
                var to = form.find("select[name=tokenB]");
                var toVal = form.find("input[name=tokenBVal]");

                var buffer = from.val();
                var bufferVal = fromVal.val();

                from.val(to.val());
                fromVal.val(toVal.val());
                to.val(buffer);
                toVal.val(bufferVal); 
            });

            $("#addPoolForm").validate({
                rules:{
                    poolAddress:{
                        required:true
                    }
                }
            });

            $("#addTokenForm").validate({
                rules:{
                    tokenAddress:{
                        required:true
                    }
                }
            });

            $("#addForm").validate({
                rules:{
                    tokenA:{
                        SelectFormat:true,
                        required:true
                    },
                    tokenB:{
                        SelectFormat:true,
                        required:true
                    },
                    tokenAVal:{
                        number:true,  
                        required:true
                    },
                    tokenBVal:{
                        number:true,  
                        required:true
                    }
                }
            })   
            
            $("#newForm").validate({
                rules:{
                    tokenA:{
                        SelectFormat:true,
                        required:true
                    },
                    tokenB:{
                        SelectFormat:true,
                        required:true
                    },
                    tokenAVal:{
                        number:true,  
                        required:true
                    },
                    tokenBVal:{
                        number:true,  
                        required:true
                    }
                }
            })   
            
            $("#addPoolModal").on('hidden.bs.modal',function(){
                //Clear Input Field
                $("input[name=poolAddress]").val("");
                $("input[name=poolAddress]").removeClass("is-invalid").removeClass("is-valid");
            })

            $(".token").on('change',function(){
                var previousToken = $(this).data("prev");                
                
                var form = $(this).closest('form').attr('id');
                
                //FIND the closest select
                var tokensSelect = $("#"+form).find("select.token");
                var tokenA = $(this);
                var tokenB = null
                for(var i = 0; i < tokensSelect.length; i++){
                    if($(tokensSelect[i]).attr('name') !== $(this).attr("name")){
                        tokenB = $(tokensSelect[i]);
                    }
                }

                if(tokenB != null){
                    //Changing Token A Value
                    if(tokenB.val() == tokenA.val()){
                        tokenB.val(previousToken);
                        tokenB.data("prev",previousToken);
                    }                    
                }                
                $(this).data("prev",$(this).val());

                //Change Message
                
                tokenA = $("#"+form).find("select[name=tokenA]").val();
                tokenB = $("#"+form).find("select[name=tokenB]").val();
                
                $("#"+ form + " .tokenA").text(App.tokens.get(tokenA).symbol);
                $("#"+form + " .tokenB").text(App.tokens.get(tokenB).symbol);
                
            })

            // $(function () {
            //     $(window).on('load', function () {
            //         App.init();
            //     });
            // });


            $(document).ready(function(){
                App.init();
                initUI();
            })

            function initUI(){
                
                var tokenA = $("#addForm").find("select[name=tokenA]").val();
                var tokenB = $("#addForm").find("select[name=tokenB]").val();

                $("#addForm .tokenA").text(App.tokens.get(tokenA).symbol);
                $("#addForm .tokenB").text(App.tokens.get(tokenB).symbol);

                tokenA = $("#newForm").find("select[name=tokenA]").val();
                tokenB = $("#newForm").find("select[name=tokenB]").val();

                $("#newForm .tokenA").text(App.tokens.get(tokenA).symbol);
                $("#newForm .tokenB").text(App.tokens.get(tokenB).symbol);
            }
        </script>
    </html>